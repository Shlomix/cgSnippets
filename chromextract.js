// 1) Paste your hashes here, one per line:
const hashesText = `
29c2f559a9494bce3d879aff8731a5d70a3789028055fd170c90965ce9cf0ea4
7ea20f9e9f3f4bce48db94f6c2354eae53e21bc130338606d45f51eba6960034
5c8710638fad8eeac382b0323461892a3e1a8865da3625403769a4378622077e
e9cc7fdfa3cf40ff9c3db0248a79f4817b170f2660aa2b2ed6c551eae1c38e0b
fe6f659301f5463d4c741d1426b659f847546da7976e56fcd6fb1a591172755b
713b699c04f21000fca981e698e1046d4595f423bd5741d712fd7e0bc358c771
6a0449a0b92dc1b17da219492487de824e86a25284f21e6e3af056fe3f4c4ec0
d6762eff16452434ac1acc127f082906cc1ae5b0ff026d0d4fe725711db47763
3d375d0ead2b63168de86ca2649360d9dcff75b3e0ffa2cf1e50816ec92b3b7d
ea1872b2835128e3cb49a0bc27e4727ca33c4e6eba1e80422db19b505f965bc4
09d6dab9b70a74f61c41eaa485b37de9a40c86b6d2eae7413db11b4e6a8256ef
81b26bbaec99dd4dadf33c08850b6a797ae05a780bd73ebb9fdcb4676a543544
796800face046765bd79f267c56a6c93ee2800b76d7f38ad96e5acb92599fcd4
4115f9548782df68dd2a7a7372ea404ce606cdfc3f90901c229d986fdd4f6ebc
ae54779badbb1e91c24c569eaaf0801b23491742bbe848a89dba4722f7f9377c
6402ca0ff75d517db9a78ddf6ca9b71597a8939e6210758ff521d623cec2d906
73da768b4ef26634d4a4480c1e4be7c309c37c2e1708e8dd265b5a14b1ea5aac
f07631b8fa1f05ba2d50783573e703100e0f458c741371d4030f151e54122371
8738e3a21b7620bc0407c27e0235623b9ac1414778ae661c86e87dd8e630e41c
12389b8af28307fd09fe080fd89802b4e616ed4c961f464f95fdb4b3f0aaf185
776ea636ee33aab6b2db5f46889b027c297280db37400efb091e0d4a9001a7d7
25dfda70c293213f92c44faf0c942b27a2076d864f2d505c6372795b36e89780
2d753bbfe6b2bd79055d2938f34ce4ea6b5a6f575cbb0977626325e3af7d3f75
e29aa629bf492a087a17fa7ec0edb6be4b84c5c8b0798857939d8824fa91dbf9
2cb2e2312dfcbc12dfe6151881dd52a1cdec2be41a020f298b87bad78ba3db74
7c5aee7745c9cd6214c5ef667aeeed502412769de47980107bc34ac349a4b0f3
361f35f787755c937e077109a90147a50c0c42f82c88061eebac4e6085df58cf
f04b5b283295b49c6880013d169b18b8579510eb274434f3434c8cb525dd9be2
cbe412af0212f987731c4360eeecb881f6c55a996dcb47265efa2f1d8fd8f8ce
533abb3f876c5ffc7e3a76874b0c4a3b4995848fa9a278c8a988af90945ecdac
11fd806cd4c320bca9dc958b2dac04e43691242421db878f266a9a5b09e12240
20e0e61d27762a524f6974fb9f4995062582db351d5576e62a214d6b5e5808e7
d089e817a0cd6123f5b93085a752a450aa3482d45cdbf7a27d7081c9a8923530
a7fd06a3b0603d7ee05d4bf551b324fff777a4d10a13d68185820b4d3208ce93
68357a471cded7dd2e195a1a5114fb27190259e8a1583b833a8325857252c5b7
b8c903f9d41335d25ac04cc81d3635b6692163bdbead07d81d8178d3484ba9e7
db4149b0c83e22451fb631609866cc03499c688d9b48979cac30b6f85f628128
c23c25621872ef6a5f6a04dc1caf283a5efb3e046f6f721e96f661d28e3e6280
678e35ca3a0e31f43ba1d07bdf678bc441dd56a0f6982dcf3fcdad96a32bd9bb
381a57ec9c6fb6571d5cb4eebcab4cae9b9eb4fb5fbf3d9d4d238a17c88eea34
e9b9f425fa818899070f69d09d3a35d7ccc88de6ac98b2c8b02116f1b314bc78
fa4f40753f7a760700d73886bb0c306699d8cd1a47966f7ade025d7988feba5c
463ee4cee193b4e1eeee91df5c343658fb708ff2795146226dd779eb11580f58
dedeb1640850a6ef21cc0efb5f1f96309f62dc10308c6b6c35a9cdadaaeffa13
23ba8078df63ebb313f2f2a2f24dab840e068ddd5cc54bb661db7d010954d2fc
ebdd27e783c515f3cdc19e3b29551aae6dcd6fb99e5aa562616c2718666f67b0
c53bd8368eb569f285919834ad50e96e93f86b17604f736b73c9ce0b3219981b
4adabf1e7e12a5a376c72b9fbf8e8ae4973be8e1d90c74ec69f2a7c9769e8490
de5a53131225dd97040d48221d9afd98760f7ff2f55613f0d08436891ca632b9
1a9fbee343348ecd006f6dd92ed915a4be3a22e9a4b0a1d00f4fc40ddb6427b8
3c4a2cbaf387826dce7be45d699ed694a2dbdbdff7ab6c16c2af5fd75d2666b2
7c897f3103e095f2c4b5777c5bb0c3c0163fd7c789061d24599e3a425789888c
83052cc23c45ecaa09fe5c87fd650c7f8e708aea46756a2b9d452d40ce3b9c00
04a655ebb59eb02a9cfcaeeb5ef9cac3822f474930dd04c00fefe182b8052c77
4968b25781df2d8913de37ac6a0dab897ce97bbe49d7f644b29284fecff711f6
1a37399489a68f8c13e7c3256ffc827caab3d68f17ea0fba530116100b442f6b
46998fe7f03cf9f870d95b6585324bbde64fe0a673382ef571662ca2f40499bb
bcc0a748732e3e8ac08edf26eb5c6350ab11301acfa63375af81ddb756f704d9
654b5c7053a50e7a32cb5d39316cbb75451423d385ac424fe0eebc5613b713d7
fc52ef7b921468a61f947946e85d600112d35995bf2f8b2d82dd9bf5af7d114c
08113ca015468d6c29af4e4e4754c003dacc194ce4a254e15f38060854f18867
fa4b9c8cefc7d6a549c2a03f66f7d3cdcd65433eeac1cef17f17f20574853622
78147d3be7dc8cf7f631de59ab7797679aba167f82655bcae2c1b70f1fafc13d
cb408d45762a628872fa782109e8fcfc3a5bf456074b007de21e9331bb3c5849
196eb5bfd52d4a538d4d0a801808298faadec1fc9aeb07c231add0161b416807
`;

// 2) Turn that into an array:
const hashes = hashesText.trim().split(/\s+/);

// 3) Main runner
async function runSicFetch() {
  const results = [];

  for (const h of hashes) {
    console.log("Querying", h);
    try {
      
      if (!res.ok) {
        console.warn("HTTP error for", h, res.status);
        results.push({ hash: h, family: "", error: "HTTP " + res.status });
        continue;
      }

      const data = await res.json();
      const attrs = data.attributes || data;

      // ---- FAMILY EXTRACTION LOGIC ----
      // Adjust these keys to match your JSON structure!
      let family = "";

      if (Array.isArray(attrs.threat_families) && attrs.threat_families.length > 0) {
        family = attrs.threat_families[0];
      } else if (Array.isArray(attrs.names) && attrs.names.length > 0) {
        family = attrs.names[0];
      } else if (typeof attrs.family === "string") {
        family = attrs.family;
      } else if (typeof attrs.threat_type === "string") {
        // fallback, just so you see *something*
        family = attrs.threat_type;
      }

      console.log(" â†’", h, "=>", family);
      results.push({ hash: h, family, raw: data });

      // small delay, be nice to the server
      await new Promise(r => setTimeout(r, 300));
    } catch (e) {
      console.error("Error for", h, e);
      results.push({ hash: h, family: "", error: String(e) });
    }
  }

  // 4) Build CSV: hash,family
  const lines = ["hash,family"];
  for (const r of results) {
    const fam = (r.family || "").replace(/"/g, '""');
    lines.push(`${r.hash},"${fam}"`);
  }

  const csvBlob = new Blob([lines.join("\n")], { type: "text/csv" });
  const url = URL.createObjectURL(csvBlob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "sic_ransom_families.csv";
  a.click();
  URL.revokeObjectURL(url);

  console.log("Done. CSV downloaded.");
}

// 5) Run it
runSicFetch();
